<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<title>Сводная ведомость — таблица</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --col-dept-w: 260px;     /* ширина столбца Отдел */
    --col-emp-w: 220px;      /* ширина столбца Сотрудник */
    --col-in-w: 140px;       /* ширина столбца Входящий остаток */
    --subcol-w: 110px;       /* ширина каждой из подколонок (Начислено/Выплачено/Остаток) */
    --head-height: 40px;     /* высота первой строки заголовка */
    --subhead-height: 34px;  /* высота второй строки заголовка */
  }

  body{font-family: Arial, Helvetica, sans-serif; margin: 12px; background:#fff;}
  h2{margin:8px 0 12px 0;}

  /* обертка фиксированного окна для скролла */
  #summaryTableWrapper{
    width: 100%;
    height: 82vh;
    border: 1px solid #cfcfcf;
    overflow: auto; /* оба направления */
    background: #fff;
    position: relative;
  }

  table.pivot {
    border-collapse: collapse;
    width: max-content; /* будет шире контейнера */
    min-width: 100%;
    table-layout: fixed;
  }

  th, td {
    border: 1px solid #ddd;
    padding: 6px 8px;
    text-align: center;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 13px;
  }

  /* Оформление заголовков */
  thead th {
    background: linear-gradient(#e6f2ff,#d6ebff);
    font-weight: 700;
    top: 0;
  }

  .subhead {
    background: #f4f8fb;
    top: calc(var(--head-height));
    font-weight: 600;
  }

  /* фиксация левых столбцов (три столбца) */
  .col-dept {
    position: sticky;
    left: 0;
    min-width: var(--col-dept-w);
    max-width: var(--col-dept-w);
    background: #fff;
    z-index: 5;
    text-align: left;
    padding-left: 10px;
  }

  .col-emp {
    position: sticky;
    left: calc(var(--col-dept-w));
    min-width: var(--col-emp-w);
    max-width: var(--col-emp-w);
    background: #fff;
    z-index: 5;
    text-align: left;
    padding-left: 10px;
  }

  .col-in {
    position: sticky;
    left: calc(var(--col-dept-w) + var(--col-emp-w));
    min-width: var(--col-in-w);
    max-width: var(--col-in-w);
    background: #fff;
    z-index: 5;
  }

  /* фиксируем заголовки сверху */
  thead tr:first-child th { position: sticky; top: 0; z-index: 10; }
  thead tr:nth-child(2) th { position: sticky; top: var(--head-height); z-index: 9; }

  /* строка группы отдела */
  .dept-group {
    background: #e9f5ff;
    font-weight: 700;
    color: #0a4d7b;
  }

  /* выделение для сотрудника */
  tbody tr td:first-child { padding-left: 8px; }

  /* широкие подколонки */
  .month-sub { min-width: var(--subcol-w); max-width: var(--subcol-w); }

  /* total row (по отделу) */
  .dept-total { background: #f3f7f9; font-weight:700; }

  /* editable входящий остаток */
  .incoming { text-align: right; padding-right: 12px; }

  /* визуал для отрицательных значений */
  .negative { color: #c62828; }

  /* небольшой responsive: если окно сильно узкое, уменьшаем subcol */
  @media (max-width: 900px){
    :root{ --subcol-w: 80px; --col-in-w: 110px; }
  }
</style>
</head>
<body>
{% load static %}
<h2>Сводная ведомость</h2>

<label for="yearSelect">Год</label>
<select id="yearSelect" style="margin-left:10px; padding:4px 8px;">
  <!-- начальное заполнение — JS перезапишет список при загрузке -->
</select>

<div id="summaryTableWrapper" aria-hidden="false">
  <table id="summaryTable" class="pivot" role="table" aria-label="Сводная ведомость"></table>
</div>

<script src="{% static 'js/summary.js' %}"></script>
</body>
</html>

