{% extends "base.html" %}
{% load static %}
{% load analytics_custom_tags %}
{% block title %}Остатки{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/balances.css' %}">
{% endblock %}

{% block content %}
{% load static %}

<div class="summary-top">
    <h2 class="summary-head">Остатки за {{ current_year }} год</h2>

    <!-- Кастомный dropdown -->
    <form method="get" action="">
        <div class="dropdown">
            <div class="dropdown-toggle" id="selected-year">
                Год: {{ current_year }}
            </div>
            <div class="dropdown-menu">
                {% for year in years %}
                    <div class="dropdown-item {% if year == current_year %}active{% endif %}" data-value="{{ year }}">
                        Год: {{ year }}
                    </div>
                {% endfor %}
            </div>
            <input type="hidden" name="year" id="year-input" value="{{ current_year }}">
        </div>
    </form>
</div>

<div class="table-container">
    <div class="block-data">
        <div class="block-info">
            <div class="block-name">
                <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="3" cy="3" r="3" fill="#282533" fill-opacity="0.6"/>
                </svg>
                <span>Приход денег</span>
            </div>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M4.17684 9.29483C4.06276 9.42719 4 9.59612 4 9.77086C4 10.1736 4.32644 10.5 4.72914 10.5H11.2709C11.6736 10.5 12 10.1736 12 9.77087C12 9.59612 11.9372 9.42719 11.8232 9.29483L8.79919 5.78644C8.60923 5.56605 8.33269 5.43932 8.04173 5.43932H7.95827C7.66731 5.43932 7.39077 5.56605 7.20081 5.78644L4.17684 9.29483Z" fill="#282533" fill-opacity="0.6"/>
            </svg>
        </div>
        <div class="data-column">
            <div class="table-head">
                <div class="head-info">
                    <div class="head-column head-column--party">
                    <span class="head-title">Плательщик/получатель</span>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H14M8 8H12M8 4H10M2 5.58333L3.00345 4.45445C3.53384 3.85776 4.46616 3.85776 4.99655 4.45445L6 5.58333M4 4V12" stroke="#A5A5A5" stroke-width="1.2" stroke-linecap="round"/>
                    </svg>
                    </div>
                    <div class="head-column head-column--incoming-balance">
                        <span class="head-title">Входящий остаток</span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H14M8 8H12M8 4H10M2 5.58333L3.00345 4.45445C3.53384 3.85776 4.46616 3.85776 4.99655 4.45445L6 5.58333M4 4V12" stroke="#A5A5A5" stroke-width="1.2" stroke-linecap="round"/>
                        </svg>
                    </div>
                </div>
                {% for month in months_name %}
                <div class="head-period">
                    <div class="head-column head-column--month">
                        <span class="head-title">{{ month }}</span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H14M8 8H12M8 4H10M2 5.58333L3.00345 4.45445C3.53384 3.85776 4.46616 3.85776 4.99655 4.45445L6 5.58333M4 4V12" stroke="#A5A5A5" stroke-width="1.2" stroke-linecap="round"/>
                        </svg>
                    </div>
                </div>
                {% endfor %}
                <div class="head-period">
                        <div class="head-column head-column--total">
                            <span class="head-title">Итого</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 12H14M8 8H12M8 4H10M2 5.58333L3.00345 4.45445C3.53384 3.85776 4.46616 3.85776 4.99655 4.45445L6 5.58333M4 4V12" stroke="#A5A5A5" stroke-width="1.2" stroke-linecap="round"/>
                            </svg>
                        </div>
                </div>
            </div>

            <div class="data-row">
                <div class="party-data">
                    {% for party_name, party_data in participants_data.items %}
                    <div class="party-data-row">
                        <div class="data-cell data-cell--party">
                            <div class="women_portrait"></div>
                            <span class="title-text">{{ party_name }}</span>
                        </div>
                        <div class="data-cell data-cell--incoming-balance">
                            <input type="number" step="0.01" 
                                value="{{ party_data.incoming_balance }}" 
                                class="input-balance"
                                data-participant="{{ party_data.participant.id }}"
                                data-year="{{ current_year }}">
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% for month in months %}
                <div class="period-data">
                    {% for party_name, party_data in participants_data.items %}
                    <div class="period-data-row">
                        {% with month_data=party_data.monthly|dict_get:month %}
                        <div class="data-cell data-cell--balance">
                            {{ month_data.income|default:0|stringformat:".2f" }}
                        </div>
                        {% endwith %}
                    </div>
                    {% endfor %}

                </div>
                {% endfor %}

                <div class="period-data">
                    {% for party_name, party_data in participants_data.items %}
                    <div class="period-data-row">
                        <div class="data-cell data-cell--balance">
                            {{ party_data.year_total.income|stringformat:".2f" }}
                        </div>    
                    </div>
                    {% endfor %}
                </div>
            </div>     
        </div>
    </div>

    <div class="block-data">
        <div class="block-info">
            <div class="block-name">
                <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="3" cy="3" r="3" fill="#282533" fill-opacity="0.6"/>
                </svg>
                <span>Выбытие денег</span>
            </div>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M4.17684 9.29483C4.06276 9.42719 4 9.59612 4 9.77086C4 10.1736 4.32644 10.5 4.72914 10.5H11.2709C11.6736 10.5 12 10.1736 12 9.77087C12 9.59612 11.9372 9.42719 11.8232 9.29483L8.79919 5.78644C8.60923 5.56605 8.33269 5.43932 8.04173 5.43932H7.95827C7.66731 5.43932 7.39077 5.56605 7.20081 5.78644L4.17684 9.29483Z" fill="#282533" fill-opacity="0.6"/>
            </svg>
        </div>
        <div class="data-column">
            <div class="table-head">
                <div class="head-info">
                    <div class="head-column head-column--party">
                    <span class="head-title">Плательщик/получатель</span>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H14M8 8H12M8 4H10M2 5.58333L3.00345 4.45445C3.53384 3.85776 4.46616 3.85776 4.99655 4.45445L6 5.58333M4 4V12" stroke="#A5A5A5" stroke-width="1.2" stroke-linecap="round"/>
                    </svg>
                    </div>
                    <div class="head-column head-column--incoming-balance">
                        <span class="head-title">Входящий остаток</span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H14M8 8H12M8 4H10M2 5.58333L3.00345 4.45445C3.53384 3.85776 4.46616 3.85776 4.99655 4.45445L6 5.58333M4 4V12" stroke="#A5A5A5" stroke-width="1.2" stroke-linecap="round"/>
                        </svg>
                    </div>
                </div>
                {% for month in months_name %}
                <div class="head-period">
                    <div class="head-column head-column--month">
                        <span class="head-title">{{ month }}</span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H14M8 8H12M8 4H10M2 5.58333L3.00345 4.45445C3.53384 3.85776 4.46616 3.85776 4.99655 4.45445L6 5.58333M4 4V12" stroke="#A5A5A5" stroke-width="1.2" stroke-linecap="round"/>
                        </svg>
                    </div>
                </div>
                {% endfor %}
                <div class="head-period">
                        <div class="head-column head-column--total">
                            <span class="head-title">Итого</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 12H14M8 8H12M8 4H10M2 5.58333L3.00345 4.45445C3.53384 3.85776 4.46616 3.85776 4.99655 4.45445L6 5.58333M4 4V12" stroke="#A5A5A5" stroke-width="1.2" stroke-linecap="round"/>
                            </svg>
                        </div>
                </div>
            </div>

            <div class="data-row">
                <div class="party-data">
                    {% for party_name, party_data in participants_data.items %}
                    <div class="party-data-row">
                        <div class="data-cell data-cell--party">
                            <div class="women_portrait"></div>
                            <span class="title-text">{{ party_name }}</span>
                        </div>
                        <div class="data-cell data-cell--incoming-balance">
                            <input type="number" step="0.01" 
                                value="{{ party_data.incoming_balance }}" 
                                class="input-balance"
                                data-participant="{{ party_data.participant.id }}"
                                data-year="{{ current_year }}">
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% for month in months %}
                <div class="period-data">
                    {% for party_name, party_data in participants_data.items %}
                    <div class="period-data-row">
                        {% with month_data=party_data.monthly|dict_get:month %}
                        <div class="data-cell data-cell--balance">
                            {{ month_data.expense|default:0|stringformat:".2f" }}
                        </div>
                        {% endwith %}
                    </div>
                    {% endfor %}

                </div>
                {% endfor %}

                <div class="period-data">
                    {% for party_name, party_data in participants_data.items %}
                    <div class="period-data-row">
                        <div class="data-cell data-cell--balance">
                            {{ party_data.year_total.expense|stringformat:".2f" }}
                        </div>    
                    </div>
                    {% endfor %}
                </div>
            </div>     
        </div>
    </div>

    <div class="block-data">
        <div class="block-info">
            <div class="block-name">
                <svg width="6" height="6" viewBox="0 0 6 6" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="3" cy="3" r="3" fill="#282533" fill-opacity="0.6"/>
                </svg>
                <span>Остаток на конец месяца</span>
            </div>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M4.17684 9.29483C4.06276 9.42719 4 9.59612 4 9.77086C4 10.1736 4.32644 10.5 4.72914 10.5H11.2709C11.6736 10.5 12 10.1736 12 9.77087C12 9.59612 11.9372 9.42719 11.8232 9.29483L8.79919 5.78644C8.60923 5.56605 8.33269 5.43932 8.04173 5.43932H7.95827C7.66731 5.43932 7.39077 5.56605 7.20081 5.78644L4.17684 9.29483Z" fill="#282533" fill-opacity="0.6"/>
            </svg>
        </div>
        <div class="data-column">
            <div class="table-head">
                <div class="head-info">
                    <div class="head-column head-column--party">
                    <span class="head-title">Плательщик/получатель</span>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H14M8 8H12M8 4H10M2 5.58333L3.00345 4.45445C3.53384 3.85776 4.46616 3.85776 4.99655 4.45445L6 5.58333M4 4V12" stroke="#A5A5A5" stroke-width="1.2" stroke-linecap="round"/>
                    </svg>
                    </div>
                    <div class="head-column head-column--incoming-balance">
                        <span class="head-title">Входящий остаток</span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H14M8 8H12M8 4H10M2 5.58333L3.00345 4.45445C3.53384 3.85776 4.46616 3.85776 4.99655 4.45445L6 5.58333M4 4V12" stroke="#A5A5A5" stroke-width="1.2" stroke-linecap="round"/>
                        </svg>
                    </div>
                </div>
                {% for month in months_name %}
                <div class="head-period">
                    <div class="head-column head-column--month">
                        <span class="head-title">{{ month }}</span>
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M8 12H14M8 8H12M8 4H10M2 5.58333L3.00345 4.45445C3.53384 3.85776 4.46616 3.85776 4.99655 4.45445L6 5.58333M4 4V12" stroke="#A5A5A5" stroke-width="1.2" stroke-linecap="round"/>
                        </svg>
                    </div>
                </div>
                {% endfor %}
                <div class="head-period">
                        <div class="head-column head-column--total">
                            <span class="head-title">Итого</span>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M8 12H14M8 8H12M8 4H10M2 5.58333L3.00345 4.45445C3.53384 3.85776 4.46616 3.85776 4.99655 4.45445L6 5.58333M4 4V12" stroke="#A5A5A5" stroke-width="1.2" stroke-linecap="round"/>
                            </svg>
                        </div>
                </div>
            </div>

            <div class="data-row">
                <div class="party-data">
                    {% for party_name, party_data in participants_data.items %}
                    <div class="party-data-row">
                        <div class="data-cell data-cell--party">
                            <div class="women_portrait"></div>
                            <span class="title-text">{{ party_name }}</span>
                        </div>
                        <div class="data-cell data-cell--incoming-balance">
                            <input type="number" step="0.01" 
                                value="{{ party_data.incoming_balance }}" 
                                class="input-balance"
                                data-participant="{{ party_data.participant.id }}"
                                data-year="{{ current_year }}">
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% for month in months %}
                <div class="period-data">
                    {% for party_name, party_data in participants_data.items %}
                    <div class="period-data-row">
                        {% with month_data=party_data.monthly|dict_get:month %}
                        <div class="data-cell data-cell--balance">
                            {{ month_data.balance|default:0|stringformat:".2f" }}
                        </div>
                        {% endwith %}
                    </div>
                    {% endfor %}

                </div>
                {% endfor %}

                <div class="period-data">
                    {% for party_name, party_data in participants_data.items %}
                    <div class="period-data-row">
                        <div class="data-cell data-cell--balance">
                            {{ party_data.year_total.balance|stringformat:".2f" }}
                        </div>    
                    </div>
                    {% endfor %}
                </div>
            </div>     
        </div>
    </div>



<!-- <div class="table-container">
    <table class="summary-table">
        <thead>
            <tr>
                <th rowspan="2" class="left">Плательщик/получатель</th>
                <th rowspan="2">Входящий остаток</th>
                {% for month in months_name %}
                    <th>{{ month }}</th>
                {% endfor %}
                <th>Итого</th>
            </tr>
        </thead>

        
        
        <tbody>
            <tr>
                <td class="left" style="background:#d9edf7; font-weight:bold;">
                    Приход денег
                </td>
            </tr>
            {% for participant_name, participant_data in participants_data.items %}
            <tr>
                
                <td class="left">{{ participant_name }}</td>
                <td>
                    <input type="number" step="0.01" 
                        value="{{ participant_data.incoming_balance }}" 
                        class="incoming-balance" 
                        data-participant="{{ participant_data.participant.id }}"
                        data-year="{{ current_year }}" 
                        style="width:80px; text-align:right;">
                        
                </td>
                
                    {% for month in months %}
                        {% with month_data=participant_data.monthly|get_item:month %}
                            {% if month_data %}
                                <td class="border-strong {% if month_data.accrued < 0 %}negative{% endif %}">{{ month_data.income|stringformat:".2f" }}</td>
                            {% else %}
                                <td>0</td>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                    <td class="border-strong {% if participant_data.year_total.income < 0 %}negative{% endif %}">{{ participant_data.year_total.income|stringformat:".2f" }}</td>
                
            </tr>
            {% endfor %}

            <tr>
                <td class="left" style="background:#d9edf7; font-weight:bold;">
                    Выбытие денег
                </td>
            </tr>
             {% for participant_name, participant_data in participants_data.items %}
            <tr>
               
                <td class="left">{{ participant_name }}</td>
                <td>
                    <input type="number" step="0.01" 
                        value="{{ participant_data.incoming_balance }}" 
                        class="incoming-balance" 
                        data-participant="{{ participant_data.participant.id }}"
                        data-year="{{ current_year }}" 
                        style="width:80px; text-align:right;">
                        
                </td>
                
                    {% for month in months %}
                        {% with month_data=participant_data.monthly|get_item:month %}
                            {% if month_data %}
                                <td class="border-strong {% if month_data.accrued < 0 %}negative{% endif %}">{{ month_data.expense|stringformat:".2f" }}</td>
                            {% else %}
                                <td>0</td>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                    <td class="border-strong {% if participant_data.year_total.expense < 0 %}negative{% endif %}">{{ participant_data.year_total.expense|stringformat:".2f" }}</td>
                
            </tr>
            {% endfor %}

            <tr>
                <td class="left" style="background:#d9edf7; font-weight:bold;">
                    Остаток на конец месяца
                </td>
            </tr>
            {% for participant_name, participant_data in participants_data.items %}
            <tr>
                
                <td class="left">{{ participant_name }}</td>
                <td>
                    <input type="number" step="0.01" 
                        value="{{ participant_data.incoming_balance }}" 
                        class="incoming-balance" 
                        data-participant="{{ participant_data.participant.id }}"
                        data-year="{{ current_year }}" 
                        style="width:80px; text-align:right;">
                       
                        
                </td>
                
                    {% for month in months %}
                        {% with month_data=participant_data.monthly|get_item:month %}
                            {% if month_data %}
                                <td class="border-strong {% if month_data.balance < 0 %}negative{% endif %}">{{ month_data.balance|stringformat:".2f" }}</td>
                            {% else %}
                                <td>0</td>
                            {% endif %}
                        {% endwith %}
                    {% endfor %}
                    <td class="border-strong {% if participant_data.year_total.balance < 0 %}negative{% endif %}">{{ participant_data.year_total.balance|stringformat:".2f" }}</td>
                
            </tr>
            {% endfor %}

        </tbody>
        

    </table>
</div> -->


<script src="{% static 'js/balances.js' %}"></script>
{% endblock %}

