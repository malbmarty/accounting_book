{% extends 'base.html' %}
{% load static %}

{% block title %}Управление справочником для аналитики{% endblock %}

{% block extra_head %}
{% load static %}
<script src="{% static 'js/analytics_dir.js' %}"></script>
{% endblock %}

{% block content %}
<h1>Управление справочником для аналитики</h1>

<div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
    
    <!-- Проекты -->
    <div>
        <h3>Проекты</h3>
        <form id="projectForm">
            {% csrf_token %}
            <input type="hidden" name="id" id="projectId">
            <div class="form-group">
                <input type="text" name="name" placeholder="Название" required>
            </div>
            <button type="submit">Сохранить</button>
            <button type="button" onclick="clearForm('projectForm')">Отмена</button>
        </form>
        <ul id="projectList">
            {% for project in projects %}
            <li>
                {{ project.name }}
                <button class="icon-btn" onclick="editItem('project', '{{ project.id }}', '{{ project.name }}')">✏️</button>
                <button class="icon-btn" onclick="deleteItem('projects', '{{ project.id }}')">❌</button>
            </li>
            {% endfor %}
        </ul>
    </div>

        <!-- Плательщики/Получатели -->
    <div>
        <h3>Плательщики/Получатели</h3>
        <form id="participantForm">
            {% csrf_token %}
            <input type="hidden" name="id" id="participantId">
            <div class="form-group">
                <input type="text" name="name" placeholder="Название/имя" required>
            </div>
            <button type="submit">Сохранить</button>
            <button type="button" onclick="clearForm('participantForm')">Отмена</button>
        </form>
        <ul id="participantList">
            {% for participant in participants %}
            <li>
                {{ participant.name }}
                <button class="icon-btn" onclick="editItem('participant', '{{ participant.id }}', '{{ participant.name }}')">✏️</button>
                <button class="icon-btn" onclick="deleteItem('participants', '{{ participant.id }}')">❌</button>
            </li>
            {% endfor %}
        </ul>
    </div>

        <!-- Платежные системы -->
    <div>
        <h3>Платежные системы</h3>
        <form id="paymentSystemForm">
            {% csrf_token %}
            <input type="hidden" name="id" id="paymentSystemId">
            <div class="form-group">
                <input type="text" name="name" placeholder="Название" required>
            </div>
            <button type="submit">Сохранить</button>
            <button type="button" onclick="clearForm('paymentSystemForm')">Отмена</button>
        </form>
        <ul id="paymentSystemList">
            {% for payment_system in payment_systems %}
            <li>
                {{ payment_system.name }}
                <button class="icon-btn" onclick="editItem('payment_system', '{{ payment_system.id }}', '{{ payment_system.name }}')">✏️</button>
                <button class="icon-btn" onclick="deleteItem('payment-systems', '{{ project.id }}')">❌</button>
            </li>
            {% endfor %}
        </ul>
    </div>
    
        <!-- Контрагент -->
    <div>
        <h3>Контрагенты</h3>
        <form id="counterpartyForm">
            {% csrf_token %}
            <input type="hidden" name="id" id="counterpartyId">
            <div class="form-group">
                <input type="text" name="name" placeholder="Название" required>
            </div>
            <button type="submit">Сохранить</button>
            <button type="button" onclick="clearForm('counterpartyForm')">Отмена</button>
        </form>
        <ul id="counterpartyList">
            {% for counterparty in counterparties %}
            <li>
                {{ counterparty.name }}
                <button class="icon-btn" onclick="editItem('counterparty', '{{ counterparty.id }}', '{{ counterparty.name }}')">✏️</button>
                <button class="icon-btn" onclick="deleteItem('counterparties', '{{ counterparty.id }}')">❌</button>
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Группы -->
    <div>
        <h3>Группы</h3>
        <form id="groupForm">
            {% csrf_token %}
            <input type="hidden" name="id" id="groupId">
            <div class="form-group">
                <input type="text" name="name" placeholder="Название" required>
            </div>
            <button type="submit">Сохранить</button>
            <button type="button" onclick="clearForm('groupForm')">Отмена</button>
        </form>
        <ul id="groupList">
            {% for group in groups %}
            <li>
                {{ group.name }}
                <button class="icon-btn" onclick="editItem('group', '{{ group.id }}', '{{ group.name }}')">✏️</button>
                <button class="icon-btn" onclick="deleteItem('groups', '{{ group.id }}')">❌</button>
            </li>
            {% endfor %}
        </ul>
    </div>

        <!-- Тип потока -->
    <div>
        <h3>Тип потока</h3>
        <form id="flowTypeForm">
            {% csrf_token %}
            <input type="hidden" name="id" id="flowTypeId">
            <div class="form-group">
                <input type="text" name="name" placeholder="Название" required>
            </div>
            <button type="submit">Сохранить</button>
            <button type="button" onclick="clearForm('flowTypeForm')">Отмена</button>
        </form>
        <ul id="flowTypeList">
            {% for flow_type in flow_types %}
            <li>
                {{ flow_type.name }}
                <button class="icon-btn" onclick="editItem('flowType', '{{ flow_type.id }}', '{{ flow_type.name }}')">✏️</button>
                <button class="icon-btn" onclick="deleteItem('flow-types', '{{ flow_type.id }}')">❌</button>
            </li>
            {% endfor %}
        </ul>
    </div>

    <!-- Изменчивость -->
    <div>
        <h3>Изменчивость</h3>
        <form id="variabilityForm">
            {% csrf_token %}
            <input type="hidden" name="id" id="variabilityId">
            <div class="form-group">
                <select name="flow_type" id="flowType" required>
                    <option value="">Выберите тип потока</option>
                    {% for flow_type in flow_types %}
                    <option value="{{ flow_type.id }}">{{ flow_type.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <input type="text" name="name" placeholder="Название типа изменчивости" required>
            </div>
            <button type="submit">Сохранить</button>
            <button type="button" onclick="clearForm('variabilityForm')">Отмена</button>
        </form>
        <ul id="variabilityList">
            {% for variability in variabilities %}
            <li>
                [{{ variability.flow_type.name }}] {{ variability.name }}
                <button class="icon-btn" onclick="editItem('variability', '{{ variability.id }}', '{{ variability.name }}', '', '{{ variability.flow_type.id }}')">✏️</button>
                <button class="icon-btn" onclick="deleteItem('variabilities', '{{ variability.id }}')">❌</button>
            </li>
            {% endfor %}
        </ul>
    </div>

   <!-- Статьи (Item) -->
    <div>
        <h3>Статьи</h3>
        <form id="itemForm">
            {% csrf_token %}
            <input type="hidden" name="id" id="itemId">
            
            <div class="form-group">
                <input type="text" name="name" placeholder="Название статьи" required>
            </div>
            
            <div class="form-group">
                <select name="group" required>
                    <option value="">Выберите группу</option>
                    {% for group in groups %}
                    <option value="{{ group.id }}">{{ group.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <select name="flow_type" id="itemFlowType" required>
                    <option value="">Выберите тип потока</option>
                    {% for flow_type in flow_types %}
                    <option value="{{ flow_type.id }}">{{ flow_type.name }}</option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group">
                <select name="variability" id="itemVariability">
                    <option value="">Выберите изменчивость</option>
                    {% for variability in variabilities %}
                    <option value="{{ variability.id }}" data-flow-type="{{ variability.flow_type.id }}">
                        {{ variability.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <button type="submit">Сохранить</button>
            <button type="button" onclick="clearForm('itemForm')">Отмена</button>
        </form>
        
        <ul id="itemList">
            {% for item in items %}
            <li>
                <strong>{{ item.name }}</strong><br>
                <small>
                    Группа: {{ item.group.name }} | 
                    Тип: {{ item.flow_type.name }} |
                    {% if item.variability %}Изменчивость: {{ item.variability.name }}{% endif %}
                </small>
                <button class="icon-btn" onclick="editItem('item', 
                    '{{ item.id }}', 
                    '{{ item.name }}', 
                    '{{ item.group.id }}',
                    '{{ item.flow_type.id }}',
                    '{{ item.variability.id }}')">✏️</button>
                <button class="icon-btn" onclick="deleteItem('items', '{{ item.id }}')">❌</button>
            </li>
            {% endfor %}
        </ul>
    </div>

</div>
<script src="{% static 'js/analytics_dir.js' %}"></script>
{% endblock %}